# Timeout Configuration for Testing

# Configuration for request timeouts, retry logic, and circuit breaker settings

request_timeout:
  # Default timeout for AI provider requests (in seconds)
  default: 120

  # Per-provider timeout overrides
  providers:
    claude: 120
    gemini: 120
    chatgpt: 120
    perplexity: 120

  # Timeout per phase (in seconds)
  phases:
    phase1_framing: 180
    phase2_research: 300
    phase3_strategy: 240
    phase4_writing: 300
    phase5_review: 180

retry_config:
  # Maximum number of retries per provider
  max_retries: 2

  # Delay between retries (in seconds)
  retry_delay: 1.0

  # Exponential backoff multiplier
  backoff_multiplier: 2.0

  # Maximum retry delay (in seconds)
  max_retry_delay: 10.0

  # Fault types that should trigger retry
  retryable_faults:
    - timeout
    - connection_refused
    - server_error_500
    - server_error_502
    - server_error_503
    - server_error_504

  # Fault types that should NOT trigger retry
  non_retryable_faults:
    - rate_limit
    - dns_failure
    - authentication_error
    - invalid_request

circuit_breaker:
  # Number of consecutive failures before opening circuit
  failure_threshold: 3

  # Time to wait before attempting recovery (in seconds)
  recovery_timeout: 60

  # Number of test requests to send in half-open state
  half_open_max_calls: 1

  # Time window for counting failures (in seconds)
  failure_window: 300

  # Providers with circuit breaker enabled
  enabled_providers:
    - claude
    - gemini
    - chatgpt
    - perplexity

fallback_chain:
  # Default fallback order
  default_order:
    - claude
    - gemini
    - chatgpt
    - perplexity

  # Custom fallback order for specific scenarios
  custom_orders:
    large_context:
      - gemini      # Largest context window
      - claude
      - chatgpt
      - perplexity

    fast_response:
      - claude      # Usually fastest
      - chatgpt
      - gemini
      - perplexity

    search_required:
      - perplexity  # Has built-in search
      - chatgpt
      - claude
      - gemini

  # Maximum number of fallback attempts
  max_fallbacks: 3

  # Whether to skip providers with open circuits
  respect_circuit_breaker: true

graceful_shutdown:
  # Enable graceful shutdown on all failures
  enabled: true

  # Save state before shutdown
  save_state: true

  # Notify user of failure
  notify_user: true

  # Maximum time to wait for shutdown (in seconds)
  shutdown_timeout: 30

  # Retry prompt for user
  retry_prompt: "Some AI providers are unavailable. Would you like to retry or resume?"

logging:
  # Log level for fallback events
  fallback_level: "WARNING"

  # Log level for circuit breaker events
  circuit_breaker_level: "INFO"

  # Include detailed error information
  verbose_errors: true

  # Log provider response times
  log_response_times: true

  # Log token usage
  log_token_usage: true

# Test-specific settings
test_settings:
  # Accelerated timeouts for testing (in milliseconds)
  accelerated_timeout_ms: 100

  # Reduced retry counts for faster tests
  test_max_retries: 1

  # Shorter circuit breaker timeout for testing
  test_recovery_timeout_sec: 5

  # Whether to use real providers or mocks
  use_real_providers: false

  # Whether to make actual network calls
  allow_network_calls: false

  # Maximum test duration (in seconds)
  max_test_duration: 60
